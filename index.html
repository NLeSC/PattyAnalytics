

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Patty Analytics &mdash; Patty Analytics 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="top" title="Patty Analytics 0.1 documentation" href="#" />
    <link rel="next" title="API reference" href="api.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api.html" title="API reference"
             accesskey="N">next</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">Patty Analytics 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Patty Analytics</a></li>
<li><a class="reference internal" href="#registration">Registration</a><ul>
<li><a class="reference internal" href="#initialization">Initialization</a></li>
<li><a class="reference internal" href="#orientation">Orientation</a></li>
<li><a class="reference internal" href="#scale">Scale</a></li>
<li><a class="reference internal" href="#position">Position</a></li>
<li><a class="reference internal" href="#future-work">Future work</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pointcloud-utilities">Pointcloud utilities</a></li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>

  <h4>Next topic</h4>
  <p class="topless"><a href="api.html"
                        title="next chapter">API reference</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="patty-analytics">
<h1>Patty Analytics<a class="headerlink" href="#patty-analytics" title="Permalink to this headline">¶</a></h1>
<p>Patty Analytics aims to register pointclouds that were generated from photos
or video to an absolute position, scale and orientation.</p>
<p>Pointclouds generated from photos are generally messy; they have holes and
floating unidentified objects. In our scripts we assume to have the following
information: a map (drivemap) which has an extremely low resolution but has
good absolute coordinates; a footprint polygon denoting more or less the
latitude and longitude and area of the object (x and y coordinates). Finally,
we have the high-resolution pointcloud of the object. By the nature of
creating this pointcloud, it is densest at the object, since the photos
usually center on this object. In some cases, there are also camera positions
available, relative to the object.</p>
</div>
<div class="section" id="registration">
<h1>Registration<a class="headerlink" href="#registration" title="Permalink to this headline">¶</a></h1>
<p>The <cite>registration.py</cite> script is the main registration algorithm. This script can be run as follows:</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>`
Usage:</p>
<blockquote>
<div>registration.py [-h] [-d &lt;sample&gt;] [-u &lt;upfile&gt;] &lt;source&gt; &lt;drivemap&gt; &lt;footprint&gt; &lt;output&gt;</div></blockquote>
<dl class="docutils">
<dt>Positional arguments:</dt>
<dd>source       Source LAS file
drivemap     Target LAS file to map source to
footprint    Footprint for the source LAS file
output       file to write output LAS to</dd>
</dl>
<p><a href="#id3"><span class="problematic" id="id4">``</span></a><a href="#id5"><span class="problematic" id="id6">`</span></a></p>
<p>Example run:
<code class="docutils literal"><span class="pre">`</span>
<span class="pre">python</span> <span class="pre">scripts/registration.py</span> <span class="pre">data/SOURCE/SITE_X.las</span> <span class="pre">data/DRIVEMAP/X.las</span> <span class="pre">data/FOOTPRINT/X.footprint.csv</span> <span class="pre">data/OUTPUT/SITE_X.las</span> <span class="pre">-d</span> <span class="pre">100000</span>
<span class="pre">`</span></code></p>
<div class="section" id="initialization">
<h2>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h2>
<p>The registration script applies a dbscan clustering algorithm before anything
else to filter out noise and end up with the densest parts of the pointcloud.
This is the slowest operation. The algorithm includes at least 70% of the
pointcloud. To speed this operation up and make its runtime predictable, the
pointcloud can be subsampled to a given number of points before doing the
clustering algorithm. A uniform probability distribution is used for this.</p>
</div>
<div class="section" id="orientation">
<h2>Orientation<a class="headerlink" href="#orientation" title="Permalink to this headline">¶</a></h2>
<p>The registration script does not yet give a definite orientation. It assumes
that objects stand on the ground, and that the footprint represents some part
of the ground. In turn we assume that both the pointcloud and drivemap are
more or less flat at this location. The first step is then to detect the
boundary of the object, resulting in a line-like subset of the pointcloud,
usually representing its demarcation at the ground and holes that have formed
during pointcloud generation. Then, a small margin around the footprint is cut
out of the drivemap. The orientation is then determined by aligning the two
principal axes of the pointclouds boundary to the drivemap cutout. The
principal axes are found by taking the first two components of a PCA of the
drivemap and the cutout. With these operations, it is still not possible to
distinguish up from down and front from back.</p>
<p>The next step is to, when available, use the camara positions to determine an
approximate UP orientation. This orientation is used to determine up from
down. Unfortunately this still does not determine front from back.</p>
</div>
<div class="section" id="scale">
<h2>Scale<a class="headerlink" href="#scale" title="Permalink to this headline">¶</a></h2>
<p>In our project, red-white meter sticks of 80 cm were placed next to the
objects, so this is a natural way to determine the object&#8217;s scale. These
sticks have two red and two white parts, each 20 cm long. The red parts are
rare in many natural environments, so we first take all red points (in HSV
color space: H &gt; 0.9 and S &gt; 0.5). Then, the remaining points are clustered
with the dbscan algorithm. The length of each cluster (each red stick part) is
determined by applying principal component analysis to find the longest axis
and measuring this axis. If three or more clusters have about the same length
and high number of points, we assign a high confidence level to the stick
scale. The fewer points we have and the fewer conforming clusters, the lower
our confidence that this scale is the correct one.</p>
<p>If these meter sticks are not available or not well represented, we determine
the scale by comparing the size of the oriented boundary of the object to the
size of the footprint, and take that as the scale.</p>
</div>
<div class="section" id="position">
<h2>Position<a class="headerlink" href="#position" title="Permalink to this headline">¶</a></h2>
<p>Once scaled and oriented, the position of the pointcloud is determined by
shifting the pointcloud boundary to the location of the footprint. Its height
is determined by the height of the cutout of the drivemap around the footprint.</p>
</div>
<div class="section" id="future-work">
<h2>Future work<a class="headerlink" href="#future-work" title="Permalink to this headline">¶</a></h2>
<p>Once the pointcloud is placed at its approximate position, a few measures
could be taken to improve its position. One way is to use ICP or GICP from the
PCL library. Since the density of the drivemap and the pointcloud differ
greatly, the poincloud probably has to be subsampled first. A complicating
factor is that the drivemap may have a grid-like topology because of its low
density whereas the pointcloud does not, which is likely to throw an ICP
algorithm off.</p>
<p>Additionally, a measure of fit could be used (nearest point cumulative
distance comes to mind) to try a few common operations. The following
operations come to mind: rotating the front to the back; scaling between 50%
and 150%; and slightly moving the object to each side.</p>
<p>The Python-PCL library currently does not support point normals. If it did, it
would give additional tools to determine rotation.</p>
</div>
</div>
<div class="section" id="pointcloud-utilities">
<h1>Pointcloud utilities<a class="headerlink" href="#pointcloud-utilities" title="Permalink to this headline">¶</a></h1>
<p>In addition to registration, this package has a few utilities for dealing with
pointclouds. In <cite>transform.py</cite>, pointclouds can be rotated, scaled and
translated. With <cite>convert.py</cite>, a pointcloud can be converted from one format
(of PCD, PLY or LAS) to another. The Spatial Reference System (SRS) of a LAS
file can be set with <cite>las_set_srs.py</cite>. Point normals are not preserved in
these operations. In the <cite>tests/helpers.py</cite> file, synthetic pointclouds can be
generated for means of testing.</p>
<p>Contents:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-patty.registration">Registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-patty.segmentation">Segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-patty.srs">SRS</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-patty.utils">Utils</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span>Index</span></a></li>
<li><a class="reference internal" href="py-modindex.html"><span>Module Index</span></a></li>
<li><a class="reference internal" href="search.html"><span>Search Page</span></a></li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api.html" title="API reference"
             >next</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">Patty Analytics 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Netherlands eScience Center.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>